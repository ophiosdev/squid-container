From: Sergio Durigan Junior <sergio.durigan@canonical.com>
Date: Tue, 9 Aug 2022 17:49:23 -0400
Subject: Fix -Werror=alloc-size-larger-than on GCC 12

Author: Sergio Durigan Junior <sergiodj@ubuntu.com>
Forwarded: yes, https://github.com/squid-cache/squid/pull/1118
---
 src/SquidConfig.h  | 2 +-
 src/pconn.cc       | 2 +-
 src/pconn.h        | 2 +-
 src/store/Disks.cc | 2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/SquidConfig.h b/src/SquidConfig.h
index feabdf1..6b3cca5 100644
--- a/src/SquidConfig.h
+++ b/src/SquidConfig.h
@@ -61,7 +61,7 @@ public:
     ~DiskConfig() { delete[] swapDirs; }

     RefCount<SwapDir> *swapDirs = nullptr;
-    int n_allocated = 0;
+    unsigned int n_allocated = 0;
     int n_configured = 0;
     /// number of disk processes required to support all cache_dirs
     int n_strands = 0;
diff --git a/src/pconn.cc b/src/pconn.cc
index 62e5411..d30726d 100644
--- a/src/pconn.cc
+++ b/src/pconn.cc
@@ -167,7 +167,7 @@ IdleConnList::clearHandlers(const Comm::ConnectionPointer &conn)
 void
 IdleConnList::push(const Comm::ConnectionPointer &conn)
 {
-    if (size_ == capacity_) {
+    if ((unsigned int) size_ == capacity_) {
         debugs(48, 3, "growing idle Connection array");
         capacity_ <<= 1;
         const Comm::ConnectionPointer *oldList = theList_;
diff --git a/src/pconn.h b/src/pconn.h
index 85e44e5..b8f07d9 100644
--- a/src/pconn.h
+++ b/src/pconn.h
@@ -80,7 +80,7 @@ private:
     Comm::ConnectionPointer *theList_;

     /// Number of entries theList can currently hold without re-allocating (capacity).
-    int capacity_;
+    unsigned int capacity_;
     ///< Number of in-use entries in theList
     int size_;

diff --git a/src/store/Disks.cc b/src/store/Disks.cc
index 4e8710a..f9c3171 100644
--- a/src/store/Disks.cc
+++ b/src/store/Disks.cc
@@ -685,7 +685,7 @@ allocate_new_swapdir(Store::DiskConfig *swap)
         swap.swapDirs = new SwapDir::Pointer[swap.n_allocated];
     }

-    if (swap.n_allocated == swap.n_configured) {
+    if (swap.n_allocated == (size_t) swap.n_configured) {
         swap.n_allocated <<= 1;
         const auto tmp = new SwapDir::Pointer[swap.n_allocated];
         for (int i = 0; i < swap.n_configured; ++i) {
